# [map 地图](http://mid.chinatowercom.cn:18080/appGuide/extend/map.html#map-地图)

该组件主要用于展示地图以及用户设定的地理位置坐标进行展示和获取。

### [基本使用](http://mid.chinatowercom.cn:18080/appGuide/extend/map.html#基本使用)

- 通过`webApiKey`参数传入 web 服务 key
- 通过`latitude`参数设置当前纬度，不传默认当前位置
- 通过`longitude`参数设置当前经度，不传默认当前位置
- 通过`markers`参数添加为地图上的气泡点

```vue
<template>
  <view class="demo">
    <view class="title">基本使用</view>
    <ct-expand-map
      ref="maps"
      :webApiKey="webApiKey"
      :webKey="webKey"
      :securityKey="securityKey"
      :latitude="latitude"
      :longitude="longitude"
      :markers="markers"
    ></ct-expand-map>
  </view>
</template>

<script>
export default {
  name: 'map',
  data() {
    return {
      webApiKey: '',
      webKey: '',
      securityKey: '',
      latitude: 39.909,
      longitude: 116.39742,
      markers: [
        {
          id: 2, //标记点id *必填
          latitude: 34.23012957196766, // 纬度 *必填
          longitude: 108.89308211478044, // 经度 *必填
          title: '', // 标注点名
          joinCluster: true, // 是否开启点聚合功能
          iconPath: '', // 显示的图标
          callout: {
            color: '#ffffff',
            content: '',
            fontSize: 16,
            borderRadius: 5,
            bgColor: '#3ebbc7',
            padding: 20,
            textAlign: 'center', // 文本对齐方式。有效值: left, right, center
            display: 'BYCLICK' // 'BYCLICK':点击显示; 'ALWAYS':常显
          }
        }
      ]
    }
  }
}
</script>

<style scoped lang="scss">
.demo {
  .title {
    margin: 20px 20px;
  }
}
</style>
```

### [调用功能](http://mid.chinatowercom.cn:18080/appGuide/extend/map.html#调用功能)

通过绑定`ref`进行手动调用组件上的功能

```vue
<template>
  <view class="demo">
    <view class="title">调用功能</view>
    <ct-expand-map
      ref="maps"
      :webApiKey="webApiKey"
      :webKey="webKey"
      :securityKey="securityKey"
      :markers="markers"
    ></ct-expand-map>
    <view class="demo-row">
      <view class="demo-row-title">坐标系转换</view>
      <view class="demo-row-btn" @click="transformationGcoord">点击转换</view>
    </view>
    <view class="demo-row">
      <view class="demo-row-title">打开当前定位</view>
      <view class="demo-row-btn" @click="chooseLocation">点击打开</view>
    </view>
    <view class="demo-row">
      <view class="demo-row-title">正逆地址解析</view>
      <view class="demo-row-btn" @click="addressResolution">点击转换</view>
    </view>
  </view>
</template>

<script>
export default {
  name: 'map',
  data() {
    return {
      webApiKey: '',
      webKey: '',
      securityKey: '',
      markers: []
    }
  },
  methods: {
    // 坐标系转换
    transformationGcoord() {
      const coordinate = {
        longitude: 0,
        latitude: 0
      }
      const currentGcoord = 'GCJ02'
      const targetGcoord = 'WGS84'
      this.$ref.maps
        .transformationGcoord(coordinate, currentGcoord, targetGcoord)
        .then((e) => {
          console.log(e)
        })
    },
    // 打开当前定位
    chooseLocation() {
      this.$ref.maps.chooseLocation()
    },
    // 正逆地址解析
    addressResolution() {
      const coordinate = {
        longitude: 0,
        latitude: 0,
        address: ''
      }
      this.$ref.maps.addressResolution(true, coordinate).then((e) => {
        console.log(e)
      })
    }
  }
}
</script>

<style scoped lang="scss">
.demo {
  .title {
    margin: 20px 20px;
  }
}
</style>
```

### [事件监听](http://mid.chinatowercom.cn:18080/appGuide/extend/map.html#事件监听)

`close`事件可以监听关闭广告，`refresh`事件可以监听广告加载失败点击的刷新按钮，`advertisingTouch`事件可以监听广告内容的点击

```vue
<template>
  <view class="demo">
    <view class="title">事件监听</view>
    <ct-expand-map
      ref="maps"
      :webApiKey="webApiKey"
      :webKey="webKey"
      :securityKey="securityKey"
      :markers="markers"
      @callouttap="callouttap"
      @markertap="markertap"
      @bubbleDelete="bubbleDelete"
      @onRegionChange="onRegionChange"
    ></ct-expand-map>
  </view>
</template>

<script>
export default {
  name: 'map',
  data() {
    return {
      webApiKey: '',
      webKey: '',
      securityKey: '',
      markers: []
    }
  },
  methods: {
    callouttap(e, current, target) {
      // e(点击的气泡点对象),current(当前经纬度对象),target(气泡点经纬度对象)
      console.log(e, current, target)
    },
    markertap(e, current, target, distance) {
      // e(点击的气泡点对象),current(当前经纬度对象),target(气泡点经纬度对象),distance(两者相差长度，单位为m)
      console.log(e, current, target, distance)
    },
    bubbleDelete(item) {
      console.log(item)
    },
    onRegionChange(item) {
      console.log(item)
    }
  }
}
</script>

<style scoped lang="scss">
.demo {
  .title {
    margin: 20px 20px;
  }
}
</style>
```

### [注意事项](http://mid.chinatowercom.cn:18080/appGuide/extend/map.html#注意事项)

- 必须要传`webApiKey`参数（**web 服务**的 key），因为第三方地图提供的服务平台不同提供可使用服务也不同，由于本组件所用的功能较广，所以必须要额外多申请服务平台为**Web 服务**
- 由于 uniapp 对第三方地图服务的支持不同，使用高德地图时需要 nvue 对次组件进行调用编译，百度地图则使用 vue 即可
- uniapp 的地图组件不支持使用 nvue 调用百度地图，所以使用百度地图第三方则不支持模式切换、路况图层和路线规划功能
- 使用 map 组件时需要在根目录下创建 **hybrid>html** 文件夹，放入 web-view 引入的 3d 地图 html 文件，由于使用的是 html 格式，所以需要申请服务平台为**Web 端**，将**web 端**的 key 通过`webKey`作为参数传入，以及**安全密钥**通过`securityKey`作为参数传入，若没传入则无法使用 3d 地图功能

### [API](http://mid.chinatowercom.cn:18080/appGuide/extend/map.html#api)

#### [Props](http://mid.chinatowercom.cn:18080/appGuide/extend/map.html#props)

| 参数                 | 说明                         | 类型    | 默认值 | 可选值      |
| -------------------- | ---------------------------- | ------- | ------ | ----------- |
| *webApiKey（必传）   | web服务所需key               | String  | -      | -           |
| *webKey（必传）      | web端所需key                 | String  | -      | -           |
| *securityKey（必传） | web端安全密钥                | String  | -      | -           |
| latitude             | 中心维度，不传默认为当前定位 | Number  | -      | -           |
| longitude            | 中心经度，不传默认为当前定位 | Number  | -      | -           |
| selectionMap         | 第三方地图SDK选择            | String  | gaode  | gaode/baidu |
| markers              | 标记点                       | Array   | []     | -           |
| 缩放级别             | 缩放级别                     | Number  | 16     | 3/20        |
| showLocation         | 显示带有方向的当前定位点     | Boolean | false  | true/false  |
| width                | 地图宽度，默认显示屏幕宽度   | String  | -      | -           |
| height               | 地图高度，默认显示屏幕高度   | String  | -      | -           |
| footButtonShow       | 是否显示底部按钮             | Boolean | false  | true/false  |
| centralCircle        | 是否显示中心园               | Boolean | false  | true/false  |
| polygons             | 绘制多边形                   | Arrray  | -      | []          |

#### [Events](http://mid.chinatowercom.cn:18080/appGuide/extend/map.html#events)

| 事件名         | 说明               | 返回值                                                       |
| -------------- | ------------------ | ------------------------------------------------------------ |
| markertap      | 点击气泡点时触发   | e(点击的气泡点对象),current(当前经纬度对象),target(气泡点经纬度对象),distance(两者相差长度，单位为m) |
| callouttap     | 点击气泡窗口时触发 | e(点击的气泡点对象),current(当前经纬度对象),target(气泡点经纬度对象) |
| bubbleDelete   | 点击删除按钮时触发 | 点击的气泡点对象                                             |
| onRegionChange | 地图移动缩放时触发 | -                                                            |

#### [Methods](http://mid.chinatowercom.cn:18080/appGuide/extend/map.html#methods)

| 名称                 | 说明                                                         | 所需参数                                                     |
| -------------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| ctNavigation         | 打开本地第三方地图软件进行导航（支持高德地图、百度地图、腾讯地图） | -                                                            |
| transformationGcoord | 坐标系转换                                                   | coordinate（经纬度坐标），currentGcoord（当前坐标系），targetGcoord（目标坐标系） |
| chooseLocation       | 打开当前定位，若定位开启则跳转到系统定位设置                 | -                                                            |
| openSetting          | 打开定位授权                                                 | -                                                            |
| distance             | 获取两地距离                                                 | la（维度）,lo（经度）                                        |
| openMap              | 打开百度地图、腾讯地图、高德地图                             | current（当前经纬度）,target（目标经纬度）                   |
| addressResolution    | 正逆地址解析                                                 | bol（true:正地址解析,false:逆地址解析）,data（解析的地址的经纬度或地址{longitude,latitude,address}） |
| openRoute            | 开始导航                                                     | mode（getWalkingRoute:步行，getRidingRoute：骑行，getDrivingRoute：驾车）  *以String方式传入，只能选择一种 |
| navigation           | 停止导航                                                     | -                                                            |
| getWay               | 路线规划                                                     | target（目的地）,mode（getWalkingRoute:步行，getRidingRoute：骑行，getDrivingRoute：驾车）  *以String方式传入，只能选择一种 |

#### [Control](http://mid.chinatowercom.cn:18080/appGuide/extend/map.html#control)

| 控件     | 说明                                       |
| -------- | ------------------------------------------ |
| 当前定位 | 将地图定位到当前位置                       |
| 模式切换 | 分别为白昼模式、夜景模式、卫星模式、3D模式 |
| 放大地图 | 将地图放大                                 |
| 缩小地图 | 将地图缩小                                 |